<% # Check if current_member is admin or officer %>
<% can_see_all_attributes = policy(current_member).admin_officer? %>

<!-- Style only included when the current controller is member and the current action is index -->
<%= stylesheet_link_tag 'member', media: 'all', 'data-turbolinks-track': 'reload' if controller_name == 'members' && action_name == 'index' %>

<%= turbo_frame_tag "members" do %>
  <p id="notice" class="mb-4"><%= notice %></p>

  <h1>Members</h1>

  <%= form_with url: "", method: :get, data: { turbo_frame: "members", turbo_action: "advance" } do |form| %>
    <div class="form-row align-items-center mb-3">
      <div class="col-auto">
        Show 
      </div>
      <div class="col-auto">
        <%= form.select :count, options_for_select([10, 25, 50, 100], selected: params[:count]), {}, { onchange: "this.form.requestSubmit()", class: "form-control" } %>
      </div>
    </div>

    <div class="form-row align-items-center mb-3">
      <div class="col-auto">
        Search 
      </div>
      <div class="col-auto">
        <%= form.search_field :query, value: params[:query], oninput: "this.form.requestSubmit()", class: "form-control" %>
      </div>
    </div>
  <% end %>

  <div class="table-responsive">
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <% if can_see_all_attributes %>
            <th scope="col">Member ID</th>
          <% end %>
          <th scope="col">First Name</th>
          <th scope="col">Last Name</th>
          <% if can_see_all_attributes %>
            <th scope="col">Email</th>
            <th scope="col">Position</th>
            <th scope="col">Points</th>
          <% end %>
          <th scope="col">Degree</th>
          <th scope="col">Date Joined</th>
          <th scope="col">Additional Info</th>
          <th scope="col" colspan="3">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @members.each do |member| %>
          <tr>
            <% if can_see_all_attributes %>
              <td><%= member.member_id %></td>
            <% end %>
            <td><%= member.first_name %></td>
            <td><%= member.last_name %></td>
            <% if can_see_all_attributes %>
              <td><%= member.email %></td>
              <td><%= member.position %></td>
              <td><%= member.points %></td>
            <% end %>
            <td><%= member.degree %></td>
            <td><%= member.date_joined %></td>
            <td class="td-content" id="dropDownButton<%= member.member_id %>" onclick="toggleDropdown('<%= member.member_id %>')">
              <div class="drop-down">
                Research Topic: <%= member.res_topic %> &#9660;
              </div>
              <div class="info-cell" id="dropDownContent<%= member.member_id %>" style="display: none;">
                Research Lab: <%= member.res_lab %> <br> 
                Research Pioneer: <%= member.res_pioneer %> <br>
                Research Descriptions: <%= member.res_description %> <br>
                Area of Study: <%= member.area_of_study %> <br>
              </div>  
            </td>
            <% if can_see_all_attributes || member == current_member %>
              <td><%= link_to "Show", member, class: "btn btn-secondary" %></td>
            <% end %>
            <% if can_see_all_attributes %>
              <td><%= link_to "Edit", edit_member_path(member), class: "btn btn-primary" %></td>
              <td><%= button_to "Delete", delete_confirmation_member_path(member), method: :get, class: "btn btn-danger" %></td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <%== pagy_nav @pagy %>
  <%= javascript_include_tag 'member_index' %>
<% end %>
