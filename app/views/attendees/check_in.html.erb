<%= turbo_frame_tag "members" do %>
  <p id="notice" class="mb-4"><%= notice %></p>

  <h1>Check In Members for Event: <%= @event.name %></h1>  
  <%= form_with url: "", method: :get, data: { turbo_frame: "members", turbo_action: "advance" } do |form| %>
    <div class="form-row align-items-center mb-3">
      <div class="col-auto">
        Show 
      </div>
      <div class="col-auto">
        <%= form.select :count, options_for_select([10, 25, 50, 100], selected: params[:count]), {}, { onchange: "this.form.requestSubmit()", class: "form-control" } %>
      </div>
    </div>

    <div class="form-row align-items-center mb-3">
      <div class="col-auto">
        Search 
      </div>
      <div class="col-auto">
        <%= form.search_field :query, value: params[:query], oninput: "this.form.requestSubmit()", class: "form-control" %>
      </div>
    </div>
  <% end %>

  <div class="table-responsive">
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th scope="col">Member ID</th>
          <th scope="col">First Name</th>
          <th scope="col">Last Name</th>
          <th scope="col">Email</th>
          <th scope="col">Position</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @members.each do |member| %>
        <% attendee = Attendee.find_by(event_id: @event.event_id, member_id: member.member_id) %>
          <tr>
            <td><%= member.member_id %></td>
            <td><%= member.first_name %></td>
            <td><%= member.last_name %></td>
            <td><%= member.email %></td>
            <td><%= member.position %></td>
            <% if attendee == nil %>
              <td>
                Member has not RSVP'd for event <br>
                <%= link_to "Check Member In", new_check_in_event_attendees_path(@event, member_id: member.member_id), class: "btn btn-secondary" %>
              </td>
            <% elsif !attendee.attended %>
              <td>
                <%= link_to "Check Member In", edit_event_attendee_path(@event, attendee), class: "btn btn-secondary" %>
              </td>
            <% else %>
              <td>
                <%= link_to "Uncheck Member", edit_event_attendee_path(@event, attendee), class: "btn btn-secondary" %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <%== pagy_nav @pagy %>
<% end %>